
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="./theme/stylesheet/style.min.css">

  <!-- <link rel="stylesheet" type="text/css" href="./theme/pygments/github.min.css"> -->
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/font-awesome.min.css">





  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="kyle thomas" />
<meta name="description" content="Summary statistics by subgroups are a quick way to get a sense of the variation in your data. In this post, we look at how to generate simple summary stats of WRDS financial data by different groups using Stata, R, and Python." />
<meta name="keywords" content="data science, python, stata, r">
<meta property="og:site_name" content="cmd+build"/>
<meta property="og:title" content="Variables by Group: Stata v R v Python"/>
<meta property="og:description" content="Summary statistics by subgroups are a quick way to get a sense of the variation in your data. In this post, we look at how to generate simple summary stats of WRDS financial data by different groups using Stata, R, and Python."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="./byvar_showdown.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2017-03-18 00:00:00-04:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="./author/kyle-thomas.html">
<meta property="article:section" content="tech"/>
<meta property="article:tag" content="data science"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="stata"/>
<meta property="article:tag" content="r"/>
<meta property="og:image" content="">

  <title>cmd+build &ndash; Variables by Group: Stata v R v Python</title>

</head>
<body>
  <aside>
    <div>
      <a href=".">
        <img src="./theme/img/profile.png" alt="" title="">
      </a>
      <h1><a href="."></a></h1>


      <ul class="social">
        <li><a class="sc-github" href="https://github.com/tkthomas27" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-linkedin" href="www.linkedin.com/in/timothykylethomas" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-twitter" href="https://twitter.com/tkylethomas27" target="_blank"><i class="fa fa-twitter"></i></a></li>
      </ul>
    

      <nav>
        <ul class="list">

          <li><a href="/about.html" target="_blank">About</a></li>
          <li><a href="/archives.html" target="_blank">Archives</a></li>
          <li><a href="/categories.html" target="_blank">Categories</a></li>
          <li><a href="/tags.html" target="_blank">Tags</a></li>
        </ul>
      </nav>

  </div>



  </aside>
  <main>


<article class="single">
  <header>
    <h1 id="byvar_showdown">Variables by Group: Stata v R v Python</h1>
    <p>
          Posted on Sat 18 March 2017 in <a href="./category/tech.html">tech</a>


    </p>
  </header>


  <div>
    <h1>1 Overview</h1>
<p><strong>The Challenge</strong>: We want to create three different summary statistics by three different groups using Stata, R, and Python. Specifically, we want to calculate:</p>
<ul>
<li><code>firm_div</code>: total dividends by firm</li>
<li><code>year_repo</code>: average share repurchases by year</li>
<li><code>sec_ni</code>: median net income by GICs Sector</li>
</ul>
<p><strong>The Data</strong>
We will be using select SP500 data from the CRSP-Compustat merged database found at WRDS. Our variables are:</p>
<ul>
<li><code>year</code> is the year of the firm's financial data; our data ranges over the 10 year period from 2005-2014</li>
<li><code>permno</code> is a unique identifier for each firm</li>
<li><code>gsector</code> is the 2-digit GICS industrial sector assigned to each firm</li>
<li><code>repo</code> is the share repurchases made by each firm each year. This number is calculated using Compustat data following Kahle (2002)</li>
<li><code>totdiv_adj</code> is the CRSP total dividends adjusted for stock splits</li>
<li><code>ni</code> is the Compustat net income (loss) number</li>
</ul>
<h1>2 Stata</h1>
<p>For Stata, we will be relying on the <code>bysort</code> and the <code>egen</code> functions.</p>
<ul>
<li>
<p><code>bysort</code> will sort the data and then carryout the function by whatever group is specified: permno, year, gsector.</p>
</li>
<li>
<p><code>egen</code> is a more powerful version of the standard <code>generate</code> function and allows to compute sums (using the <code>total</code> function), <code>mean</code>, and <code>median</code>.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="c">* total dividends by firm</span><span class="k"></span>
<span class="k">bysort</span> permno :<span class="k"> egen</span> firm_div =<span class="k"> total</span>(totdiv_adj)

<span class="c">* average repurchases by year</span><span class="k"></span>
<span class="k">bysort</span> year :<span class="k"> egen</span> year_repo =<span class="k"> mean</span>(repo)

<span class="c">* median net income by GICs Sector</span><span class="k"></span>
<span class="k">bysort</span> gsector :<span class="k"> egen</span> sec_ni =<span class="k"> median</span>(ni)
</pre></div>


<h1>3 R</h1>
<p>For R, we will be using the base <code>aggregate</code> function. The form it takes is <code>aggregate(x, group, fun)</code>. This will apply function <code>fun</code> to <code>x</code> by <code>group</code>. Our <code>x</code>s will be dividends, repurchases, and net income. Our <code>group</code>s will be firm, year, and GICs sector. And our <code>fun</code>s will be total, mean, and median</p>
<div class="highlight"><pre><span></span><span class="c1"># total dividends by firm</span>
firm_div <span class="o">&lt;-</span> aggregate<span class="p">(</span>sp500_dat<span class="o">$</span>totdiv_adj<span class="p">,</span> <span class="kt">list</span><span class="p">(</span>Firm<span class="o">=</span>sp500_dat<span class="o">$</span>permno<span class="p">),</span> <span class="kp">sum</span><span class="p">)</span>

<span class="c1"># average repurchases by year</span>
year_repo <span class="o">&lt;-</span> aggregate<span class="p">(</span>sp500_dat<span class="o">$</span>repo<span class="p">,</span> <span class="kt">list</span><span class="p">(</span>Year<span class="o">=</span>sp500_dat<span class="o">$</span>year<span class="p">),</span> <span class="kp">mean</span><span class="p">)</span>

<span class="c1"># median net income by GICs Sector</span>
sec_ni <span class="o">&lt;-</span> aggregate<span class="p">(</span>sp500_dat<span class="o">$</span>ni<span class="p">,</span> <span class="kt">list</span><span class="p">(</span>Sector<span class="o">=</span>sp500_dat<span class="o">$</span>gsector<span class="p">),</span> median<span class="p">)</span>
</pre></div>


<h1>4 Python</h1>
<p>For Python, one of the easiest ways to compute summary statistics by groups is to use Pandas. To do so, first read in the data as a Pandas dataframe. Now we can use the following syntax: <code>data.groupby(group)[x].fun()</code>. Like the R example, our <code>x</code>s will be dividends, repurchases, and net income; our <code>group</code>s will be firm, year, and GICs sector; and our <code>fun</code>s will be total, mean, and median</p>
<div class="highlight"><pre><span></span><span class="c1"># read in data as a pandas dataframe</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">sp500_dat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;sp500_dat.csv&quot;</span><span class="p">)</span>

<span class="c1"># total dividends by firm</span>
<span class="n">sp500_dat</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;permno&#39;</span><span class="p">)[</span><span class="s1">&#39;totdiv_adj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># average repurchases by year</span>
<span class="n">sp500_dat</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)[</span><span class="s1">&#39;repo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># median net income by GICs Sector</span>
<span class="n">sp500_dat</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;gsector&#39;</span><span class="p">)[</span><span class="s1">&#39;ni&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</pre></div>


<h1>5 Conclusion</h1>
<p>Given the simplicity of the functions, performance is not really issue. R is clearly the wordiest with the need to specify <code>data$var</code> for each variable. By leveraging Pandas, Python is the most succinct. The most "natural" would be Stata in that the code reads very much like how you would describe the variable (which is funny given Python's emphasis on things being "Pythonic").</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="./tag/data-science.html">data science</a>
      <a href="./tag/python.html">python</a>
      <a href="./tag/stata.html">stata</a>
      <a href="./tag/r.html">r</a>
    </p>
  </div>




</article>

    <footer>
<p>&copy; kyle thomas </p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " cmd+build ",
  "url" : ".",
  "image": "",
  "description": ""
}
</script>
</body>
</html>